<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LotLocate PH</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css'
        rel='stylesheet' />
</head>

<body>
    <header class="app-header bg-light py-3">
        <h1 class="text-center">LotLocate PH</h1>
    </header>
    <div class="alert alert-warning alert-dismissible fade show m-0 rounded-0" role="alert" id="disclaimerBar">
        <strong>Disclaimer:</strong> The output of this application is for viewing and preliminary assessment purposes
        only and cannot be used for legal purposes.
        It is advised to seek assistance from a duly licensed Geodetic Engineer or verify results from the mandated
        government agencies (e.g., LMB, LRA, DENR).
        The accuracy of the output is dependent on the accuracy of the input data and the selected reference point.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" id="closeDisclaimerBtn"></button>
    </div>

    <div class="app-main-container container-fluid">
        <div class="row">
            <aside class="sidebar col-md-4 col-lg-3">
                <div class="message-area mb-3" id="formMessages">
                    {% if csv_error_message %}<div class="alert alert-danger">{{ csv_error_message }}</div>{% endif %}
                </div>
                <div class="card mb-3">
                    <div class="card-header">
                        <h2>Global Settings</h2>
                </div>
                <div class="card-body">
                    <form id="globalSettingsForm" onsubmit="return false;">
                        <div class="mb-3">
                            <label for="target_crs_select" class="form-label">Coordinate Reference System (CRS):</label>
                            <select name="target_crs_select" id="target_crs_select" class="form-select">
                                <option value="25391">PRS92 / Philippines Zone I (EPSG:25391)</option>
                                <option value="25392">PRS92 / Philippines Zone II (EPSG:25392)</option>
                                <option value="25393" selected>PRS92 / Philippines Zone III (EPSG:25393)</option>
                                <option value="25394">PRS92 / Philippines Zone IV (EPSG:25394)</option>
                                <option value="25395">PRS92 / Philippines Zone V (EPSG:25395)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="reference_point_select" class="form-label">Reference Point (match CRS Zone):</label>
                            <select name="reference_point_select" id="reference_point_select" class="form-select" style="width: 100%;"
                                required>
                                {% if reference_points_data %}<option value=""></option>
                                {% for point in reference_points_data %}
                                <option value="{{ point.display_name }}" {% if selected_ref_point_name==point.display_name %}selected{% endif %}>{{ point.display_name }}</option>
                                {% endfor %}
                                {% else %}<option value="" disabled selected>Error loading points</option>{% endif %}
                            </select>
                            <small class="form-text text-muted">Ensure point's coordinates are for selected CRS.</small>
                        </div>

                        <h3 class="settings-subsection-header h5 mt-4 mb-3">Map Display Options</h3>
                        <div class="form-check mb-2">
                            <input type="checkbox" id="toggleTieLines" name="toggleTieLines" class="form-check-input" checked>
                            <label for="toggleTieLines" class="form-check-label">Show Tie-Lines</label>
                        </div>
                        <div class="form-check mb-2">
                            <input type="checkbox" id="togglePobMarkers" name="togglePobMarkers" class="form-check-input" checked>
                            <label for="togglePobMarkers" class="form-check-label">Show POB Markers</label>
                        </div>
                        <div class="form-check mb-2">
                            <input type="checkbox" id="toggleParcelVertices" name="toggleParcelVertices" class="form-check-input" checked>
                            <label for="toggleParcelVertices" class="form-check-label">Show Parcel Vertices</label>
                        </div>

                        <div class="mb-3">
                            <label for="basemapSelect" class="form-label">Basemap:</label>
                            <select name="basemapSelect" id="basemapSelect" class="form-select">
                                <option value="esriImagery">Esri World Imagery (Default)</option>
                                <option value="osmStandard">OpenStreetMap</option>
                                <option value="esriStreet">Esri World Street Map</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">
                    <h2>Survey Lots</h2>
                </div>
                <div class="card-body">
                    <ul id="lotList" class="list-group mb-3">
                        <!-- TODO for future subtask (modify static/js/app.js - addLot function):
                             Dynamically added <li> elements should have class="list-group-item".
                             The active <li> should also get class="active".
                        -->
                    </ul>
                    <div class="d-grid gap-2">
                        <button type="button" id="addLotBtnSidebar" class="btn btn-success">+ Add New Lot</button>
                        <button type="button" id="clearAllLotsBtn" class="btn btn-danger">Clear All Lots</button>
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">
                    <h2>Survey Management</h2>
                </div>
                <div class="card-body">
                    <div id="activeSaveStatusContainer" class="alert alert-info p-2 mb-3 text-center">
                        <span class="fw-bold small">Current Save:</span> <span id="activeSaveNameDisplay" class="small text-primary fw-medium">Default Survey</span>
                    </div>
                    <div class="d-grid gap-2 mb-3">
                        <button type="button" id="saveSurveyBtn" class="btn btn-primary">Save Current Survey</button>
                        <button type="button" id="saveAsSurveyBtn" class="btn btn-info">Save As...</button>
                    </div>
                    <div class="mb-3">
                        <label for="savedSurveysDropdown" class="form-label">Load a saved survey:</label>
                        <select id="savedSurveysDropdown" class="form-select">
                            <option value="" disabled selected>Select a survey...</option>
                        </select>
                    </div>
                    <div class="d-grid gap-2 mb-3">
                        <button type="button" id="loadSelectedSurveyBtn" class="btn btn-success" disabled>Load Selected Survey</button>
                        <button type="button" id="deleteSelectedSurveyBtn" class="btn btn-warning" disabled>Delete Selected Survey</button>
                    </div>
                    <div class="d-grid gap-2">
                        <button type="button" id="exportSurveyDataBtn" class="btn btn-info">Export Survey Data (.llph)</button>
                         <input type="file" id="importSurveyFile" accept=".llph,.json" class="d-none">
                        <button type="button" id="importSurveyDataBtn" class="btn btn-success">Import Survey Data</button>
                    </div>
                    <hr class="my-4">
                    <div class="d-grid">
                        <button id="resetApplicationDataBtn" class="btn btn-danger">Reset All Application Data</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Export Options</h3>
                </div>
                <div class="card-body d-grid gap-2">
                    <button type="button" id="exportShapefileBtn" class="btn btn-outline-secondary">Export Shapefiles (.zip)</button>
                    <button type="button" id="exportKmzBtn" class="btn btn-outline-secondary">Export KMZ (.kmz)</button>
                    <button type="button" id="exportDxfBtn" class="btn btn-outline-secondary">Export DXF (.dxf)</button>
                    <button type="button" id="exportGeoJsonBtn" class="btn btn-outline-secondary">Export GeoJSON (.geojson)</button>
                </div>
            </div>
        </aside>

        <main class="main-content-area col-md-8 col-lg-9">
            <section id="activeLotEditorArea" class="active-lot-editor-container placeholder card">
                <div class="card-body">
                    Select a lot from the list or add a new one to start editing.
                    <!--
                        TODO for future subtask (modify static/js/app.js - renderActiveLotEditor function):
                        When this area is populated by JavaScript, apply Bootstrap classes.

                        Overall structure generated by renderActiveLotEditor():
                        <div class="lot-editor-header">...</div>
                        <div class="survey-point-editor">...</div>
                        <div class="misclosure-display-section">...</div>
                        <div class="area-display-section">...</div>
                        <button class="btn btn-primary btn-add-point-to-lot">...</button>

                        Recommendations for Bootstrap classes:

                        1. lot-editor-header:
                           - div: "d-flex align-items-center mb-3 p-2 border-bottom"
                           - btn-toggle-editor: "btn btn-sm btn-outline-secondary me-2" (for minimize/maximize)
                           - label: "form-label me-2 mb-0" (for "Lot:")
                           - lot-name-input: "form-control form-control-sm flex-grow-1"

                        2. survey-point-editor:
                           - h3: "h5 mt-3 mb-3" (for "Survey Data Points for...")
                           - point-headers div: "d-flex justify-content-between align-items-center mb-2 text-muted small border-bottom pb-1"
                             - Spans within point-headers: Consider "col" or "flex-fill p-1" for even spacing. E.g. header-label "col-2", header-ns "col-1", etc.
                           - surveyPointsListContainer: No specific class, rows inside are styled.

                        3. survey-point-row (generated by addSurveyPointRowToActiveEditor):
                           - Outer div.survey-point-row: "d-flex align-items-center mb-2 p-1 border rounded"
                           - span.point-label: "me-2 small text-muted col-form-label" (adjust width/flex as needed)
                           - select.point-input, input.point-input: "form-select form-select-sm me-1" or "form-control form-control-sm me-1".
                                                                  Use "flex-grow-1" for dynamic width or specific "col-md-*" classes.
                           - div.btn-remove-point-container: "ms-auto"
                           - button.btn-remove-point: "btn btn-sm btn-outline-danger"

                        4. misclosure-display-section & area-display-section:
                           - Outer div: "mt-3 p-3 border rounded bg-light"
                           - h4: "h6"
                           - p: "mb-1 small" (for Distance, Bearing, Sqm, Hectares)

                        5. Button btn-add-point-to-lot:
                           - class: "btn btn-primary btn-sm mt-3 d-block w-100" (or similar for sizing/spacing)
                           - (already has btn btn-primary)

                        General:
                        - Ensure padding/margins (e.g., "p-3", "m-2") are used effectively for spacing.
                        - Replace custom CSS for these elements with Bootstrap utilities where possible.
                        - The placeholder text "Select a lot..." is fine as is.
                    -->
                </div>
            </section>

            <section class="map-container">
                <div id="map" style="height: 100vh; width: 100%;"> <!-- Ensure map takes full height of its container -->
                    <div id="coordinate-display"></div>
                </div>
            </section>
        </main>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const allReferencePointsData = JSON.parse({{ reference_points_data_json|tojson|safe }});
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p id="loadingMessage">Processing...</p>
    </div>
</body>

</html>